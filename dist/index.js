(()=>{"use strict";var e={37:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.configDefault=void 0,t.configDefault={elements:{point:{size:8,color:"#087E8B",opacity:.25},guide:{size:1,color:"#FF5A5F",opacity:.25},circuit:{size:1,color:"#087E8B",opacity:.25},polygon:{color:"#C1839F",opacity:.5,point:{size:8,color:"#C1839F",opacity:.5}},menu:{style:{fontSize:"0.8em",padding:"0.5em 1em",lineHeight:"1",cursor:"pointer",backgroundColor:"#E56B6F",color:"#FFFFFF",userSelect:"none"}}},events:{onPolygonChange:null,onPolygonCreate:null}}},612:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.circuit=void 0,t.circuit=function(e,t,n){var r=e.polyline(t).stroke({width:n.size,color:n.color,opacity:n.opacity}).fill("transparent");return{update:function(e){r.plot(e)},remove:function(){r.remove()}}}},826:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.guide=void 0;var u=i(n(18));t.guide=function(e,t,n,r){var o=u.point(e,n,r.elements.point),i=e.line([t.toArray(),n.toArray()]).stroke({width:r.elements.guide.size,color:r.elements.guide.color,opacity:r.elements.guide.opacity});return{update:function(e,t){o.update(t),i.plot([e.toArray(),t.toArray()])},remove:function(){o.remove(),i.remove()}}}},18:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.polygon=t.point=t.menu=t.guide=t.circuit=void 0;var r=n(612);Object.defineProperty(t,"circuit",{enumerable:!0,get:function(){return r.circuit}});var o=n(826);Object.defineProperty(t,"guide",{enumerable:!0,get:function(){return o.guide}});var i=n(932);Object.defineProperty(t,"menu",{enumerable:!0,get:function(){return i.menu}});var u=n(930);Object.defineProperty(t,"point",{enumerable:!0,get:function(){return u.point}});var a=n(195);Object.defineProperty(t,"polygon",{enumerable:!0,get:function(){return a.polygon}})},932:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.menu=void 0,t.menu=function(e,t,n,r){var o=document.createElement("div");return o.innerText="Удалить",Object.keys(n.style).forEach((function(e){o.style[e]=n.style[e]})),e.appendChild(o),o.style.position="absolute",o.style.top="".concat(t.y,"px"),o.style.left="".concat(t.x,"px"),o.addEventListener("click",r),{remove:function(){o.remove()}}}},930:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.point=void 0;var r=n(868),o=n(955),i=n(445);t.point=function(e,t,n,u){void 0===u&&(u={});var a=(0,o.getRandomId)(),c=n.size,l=(0,o.getCenteredCords)(t,c,c),d=l.x,s=l.y,f=e.circle(c).move(d,s).fill(n.color),p={cords:t};return u.onDrag&&((0,i.setPreventDrawing)(f),f.draggable(),f.on("dragmove",(function(t){var n=t.detail.event,i=n.clientX,c=n.clientY;p.cords=(0,o.getRelativeCords)(new r.Point(i,c),e.node),u.onDrag(a,p.cords)}))),u.onDragComplete&&f.on("dragend",(function(){"function"==typeof u.onDragComplete&&u.onDragComplete()})),{uid:a,cords:p.cords,update:function(e){f.move.apply(f,(0,o.getCenteredCords)(e,c,c).toArray()),p.cords=e},remove:function(){f.remove()}}}},195:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},u=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.polygon=void 0;var a=n(868),c=i(n(955)),l=i(n(18)),d=i(n(191));t.polygon=function(e,t,n,r){var o=c.getRandomId(),i={points:[],get path(){return this.points.map((function(e){return e.cords.toArray()}))}},s=e.polygon(t).fill(r.color).opacity(r.opacity);return d.setPreventDrawing(s),setTimeout((function(){e.fire("polygonCreate",{uid:o})}),0),s.draggable(),s.on("click",(function(){d.removeMenu(n)})),s.on("dragmove",(function(){s.array().forEach((function(e,t){i.points[t].update(new(a.Point.bind.apply(a.Point,u([void 0],e,!1)))),i.points[t].cords=new(a.Point.bind.apply(a.Point,u([void 0],e,!1)))}))})),s.on("dragend",(function(){s.array().forEach((function(e,t){i.points[t].update(new(a.Point.bind.apply(a.Point,u([void 0],e,!1)))),i.points[t].cords=new(a.Point.bind.apply(a.Point,u([void 0],e,!1)))})),e.fire("polygonDragEnd",{uid:o})})),s.node.addEventListener("contextmenu",(function(t){t.preventDefault();var n=c.getRelativeCords(c.getMouseCords(t),e.node);e.fire("menu",{uid:o,cords:n})})),i.points=t.map((function(t){return l.point(e,new a.Point(t),r.point,{onDrag:function(e,t){var n=i.points.find((function(t){return t.uid===e}));n&&(n.cords=t,s.plot(i.path))},onDragComplete:function(){e.fire("polygonDragEnd",{uid:o})}})})),{uid:o,points:i.points,remove:function(){s.remove(),i.points.forEach((function(e){return e.remove()}))}}}},900:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clearScene=void 0,t.clearScene=function(e){e.isDrawGuide=!1,e.points.forEach((function(e){return e.remove()})),e.points=[],e.guide&&(e.guide.remove(),e.guide=null),e.circuit&&(e.circuit.remove(),e.circuit=null)}},744:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.continueDrawing=void 0;var u=i(n(18));t.continueDrawing=function(e,t,n){var r=u.point(e,n,t.config.elements.point);t.points.push(r),t.circuit?t.circuit.update(t.pointsArray):t.circuit=u.circuit(e,t.pointsArray,t.config.elements.circuit)}},191:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.startDrawing=t.setPreventDrawing=t.removeMenu=t.placePolygon=t.continueDrawing=t.clearScene=void 0;var r=n(900);Object.defineProperty(t,"clearScene",{enumerable:!0,get:function(){return r.clearScene}});var o=n(744);Object.defineProperty(t,"continueDrawing",{enumerable:!0,get:function(){return o.continueDrawing}});var i=n(805);Object.defineProperty(t,"placePolygon",{enumerable:!0,get:function(){return i.placePolygon}});var u=n(387);Object.defineProperty(t,"removeMenu",{enumerable:!0,get:function(){return u.removeMenu}});var a=n(445);Object.defineProperty(t,"setPreventDrawing",{enumerable:!0,get:function(){return a.setPreventDrawing}});var c=n(623);Object.defineProperty(t,"startDrawing",{enumerable:!0,get:function(){return c.startDrawing}})},805:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.placePolygon=void 0;var u=i(n(18));t.placePolygon=function(e,t,n,r){t.polygons.push(u.polygon(e,n,t,r))}},387:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeMenu=void 0,t.removeMenu=function(e){var t;null===(t=e.menu)||void 0===t||t.remove(),e.menu=null}},445:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setPreventDrawing=void 0,t.setPreventDrawing=function(e){e.attr("data-prevent-drawing",!0)}},623:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.startDrawing=void 0;var u=i(n(18));t.startDrawing=function(e,t,n){var r=u.point(e,n,t.config.elements.point);t.isDrawGuide=!0,t.points.push(r)}},607:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},u=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,a)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(u=0)),u;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,r=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!((o=(o=u.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.polydraw=void 0;var l=n(868);n(939);var d=c(n(489)),s=n(37),f=i(n(955)),p=i(n(18)),g=i(n(191));t.polydraw=function(e,t,n){return void 0===n&&(n={}),u(void 0,void 0,void 0,(function(){var r,o,i,u;return a(this,(function(a){switch(a.label){case 0:return r=(0,l.SVG)(),o=document.querySelector(e),[4,f.getImage(t)];case 1:return i=a.sent(),u={config:(0,d.default)(s.configDefault,n),scale:f.getImageScale(i,o),isDrawGuide:!1,points:[],polygons:[],guide:null,circuit:null,menu:null,get pointsArray(){return this.points.map((function(e){return e.cords.toArray()}))},get data(){return{polygon:this.polygons.map((function(e){return f.polygon2object(e,u.scale)}))}}},o?(o.style.position="relative",o.appendChild(i),i.style.width="".concat(i.width,"px"),i.style.minWidth="".concat(i.width,"px"),i.style.height="".concat(i.height,"px"),i.style.minHeight="".concat(i.height,"px"),r.addTo(e),r.node.style.position="absolute",r.node.style.left="0",r.node.style.top="0",r.node.style.width="100%",r.node.style.height="100%",r.on("mousedown",(function(e){var t,n=f.getRelativeCords(f.getMouseCords(e),r.node);g.removeMenu(u);var o=!u.points.length,i=e.target;null===(t=u.guide)||void 0===t||t.remove(),i.dataset.preventDrawing||(o?g.startDrawing(r,u,n):f.isCordsInside(n,u.points[0].cords,u.config.elements.point.size)?(g.placePolygon(r,u,u.pointsArray,u.config.elements.polygon),g.clearScene(u)):g.continueDrawing(r,u,n))})),r.on("mousemove",(function(e){var t;if(u.isDrawGuide){var n=u.points[u.points.length-1].cords,o=f.getRelativeCords(f.getMouseCords(e),r.node);null===(t=u.guide)||void 0===t||t.remove(),u.guide=p.guide(r,n,o,u.config)}})),r.on("menu",(function(e){var t=e.detail,n=t.cords,r=t.uid,i=u.config.elements.menu;u.menu=p.menu(o,n,i,(function(){var e=u.polygons.findIndex((function(e){return e.uid===r}));u.polygons[e]&&(u.polygons[e].remove(),u.polygons=u.polygons.filter((function(e){return e.uid!==r})),g.removeMenu(u))}))})),r.on("polygonDragEnd",(function(e){var t=e.detail.uid,n=u.polygons.find((function(e){return e.uid===t}));n&&u.config.events.onPolygonChange&&u.config.events.onPolygonChange(f.polygon2object(n,u.scale))})),r.on("polygonCreate",(function(e){var t=e.detail.uid,n=u.polygons.find((function(e){return e.uid===t}));n&&u.config.events.onPolygonCreate&&u.config.events.onPolygonCreate(f.polygon2object(n,u.scale))})),window.addEventListener("keyup",(function(e){"Escape"===e.key&&g.clearScene(u)})),[2,{placePolygon:function(e){var t=e.points.map((function(e){var t=e.x,n=e.y;return new l.Point(t,n).toArray()}));g.placePolygon(r,u,f.getScaledCords(t,u.scale),u.config.elements.polygon)},get data(){return u.data}}]):[2]}}))}))}},526:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCenteredCords=void 0;var r=n(868);t.getCenteredCords=function(e,t,n){var o=e.x,i=e.y;return new r.Point(o-t/2,i-n/2)}},210:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getImage=void 0,t.getImage=function(e){return new Promise((function(t){var n=new Image;n.src=e,n.style.display="block",n.addEventListener("load",(function(){t(n)}))}))}},981:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getImageScale=void 0,t.getImageScale=function(e,t){return e.naturalWidth/t.clientWidth}},243:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getMouseCords=void 0;var r=n(868);t.getMouseCords=function(e){var t=e.clientX,n=e.clientY;return new r.Point(t,n)}},249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRandomId=void 0,t.getRandomId=function(e){return void 0===e&&(e=6),"_".concat(Math.random().toString(36).substring(2,e+2))}},368:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRelativeCords=void 0;var r=n(868);t.getRelativeCords=function(e,t){var n=t.getBoundingClientRect(),o=n.x,i=n.y;return new r.Point(e.x-o,e.y-i)}},944:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getScaledCords=void 0,t.getScaledCords=function(e,t){return void 0===t&&(t=1),e.map((function(e){return[e[0]/t,e[1]/t]}))}},454:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getShapeCenter=void 0;var r=n(868);t.getShapeCenter=function(e){var t=e.map((function(e){return e[0]})),n=e.map((function(e){return e[1]})),o=Math.max.apply(Math,t),i=Math.min.apply(Math,t),u=Math.max.apply(Math,n),a=Math.min.apply(Math,n),c=i+(o-i)/2,l=a+(u-a)/2;return new r.Point(c,l)}},955:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.polygon2object=t.isCordsInside=t.getShapeCenter=t.getScaledCords=t.getRelativeCords=t.getRandomId=t.getMouseCords=t.getImageScale=t.getImage=t.getCenteredCords=void 0;var r=n(526);Object.defineProperty(t,"getCenteredCords",{enumerable:!0,get:function(){return r.getCenteredCords}});var o=n(210);Object.defineProperty(t,"getImage",{enumerable:!0,get:function(){return o.getImage}});var i=n(981);Object.defineProperty(t,"getImageScale",{enumerable:!0,get:function(){return i.getImageScale}});var u=n(243);Object.defineProperty(t,"getMouseCords",{enumerable:!0,get:function(){return u.getMouseCords}});var a=n(368);Object.defineProperty(t,"getRelativeCords",{enumerable:!0,get:function(){return a.getRelativeCords}});var c=n(454);Object.defineProperty(t,"getShapeCenter",{enumerable:!0,get:function(){return c.getShapeCenter}});var l=n(944);Object.defineProperty(t,"getScaledCords",{enumerable:!0,get:function(){return l.getScaledCords}});var d=n(249);Object.defineProperty(t,"getRandomId",{enumerable:!0,get:function(){return d.getRandomId}});var s=n(322);Object.defineProperty(t,"isCordsInside",{enumerable:!0,get:function(){return s.isCordsInside}});var f=n(377);Object.defineProperty(t,"polygon2object",{enumerable:!0,get:function(){return f.polygon2object}})},322:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCordsInside=void 0,t.isCordsInside=function(e,t,n){return void 0===n&&(n=2),t.x+n>e.x&&t.x-n<e.x&&t.y+n>e.y&&t.y-n<e.y}},377:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.polygon2object=void 0;var r=n(868);t.polygon2object=function(e,t){return void 0===t&&(t=1),{points:e.points.map((function(e){var n=e.cords;return new r.Point(n.x*t,n.y*t)}))}}},939:e=>{e.exports=require("@svgdotjs/svg.draggable.js")},868:e=>{e.exports=require("@svgdotjs/svg.js")},489:e=>{e.exports=require("ts-deepmerge")}},t={},n=function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}(607),r=exports;for(var o in n)r[o]=n[o];n.__esModule&&Object.defineProperty(r,"__esModule",{value:!0})})();